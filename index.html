<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <!-- スマホでの表示に合わせてviewportを設定 -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>授受簿サンプル</title>
  <style>
    /* テーブルの簡易スタイル */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1rem;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 0.5rem;
      text-align: center;
    }
    th {
      cursor: pointer; /* ソート可能列のためカーソルをポインタに */
      background-color: #f0f0f0;
    }
    /* PC画面用の簡易デザイン */
    @media screen and (min-width: 768px) {
      body {
        margin: 2rem auto;
        max-width: 800px;
        font-size: 16px;
      }
    }
    /* 完了行に付与されるクラス。まとめて非表示にする際に使用 */
    .completed {
      background-color: #d3d3d3; /* 完了行と分かるように色を変えておく（任意） */
    }
    /* 非表示にするためのクラス */
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <h1>授受簿サンプル</h1>

  <!-- 新規登録フォーム -->
  <div>
    <label for="futakuInput">付託番号：</label>
    <input type="text" id="futakuInput" placeholder="例：12345">
    
    <label for="dateInput">ステータス移行月日：</label>
    <input type="date" id="dateInput">
    
    <button onclick="addRow()">新規登録</button>
  </div>

  <!-- 一括に非表示ボタン -->
  <div style="margin-top: 1rem;">
    <button onclick="hideCompletedRows()">一括に非表示</button>
  </div>

  <!-- テーブル -->
  <table id="myTable">
    <thead>
      <tr>
        <th onclick="sortTable(0)">付託番号</th>
        <th onclick="sortTable(1)">ステータス移行月日</th>
        <th>完了</th>
      </tr>
    </thead>
    <tbody>
      <!-- 新規登録時、ここに行が追加される -->
    </tbody>
  </table>

  <script>
    // テーブルソート機能
    // colIndexに応じて、付託番号(文字列ソート)か日付ソートかを行う
    function sortTable(colIndex) {
      const table = document.getElementById("myTable");
      const tbody = table.querySelector("tbody");
      const rows = Array.from(tbody.rows);

      // ソートの種類を判定（0番目は文字列、1番目は日付想定）
      let isDateSort = (colIndex === 1);

      rows.sort((a, b) => {
        const cellA = a.cells[colIndex].innerText;
        const cellB = b.cells[colIndex].innerText;

        if(isDateSort) {
          // 日付をソート
          // 空欄や不正な日付が入る場合は fallback
          const dateA = new Date(cellA).getTime() || 0;
          const dateB = new Date(cellB).getTime() || 0;
          return dateA - dateB;
        } else {
          // 文字列ソート(付託番号)
          return cellA.localeCompare(cellB, 'ja');
        }
      });

      // ソート後の順序でtbodyに再度append
      rows.forEach(row => tbody.appendChild(row));
    }

    // 新規行を追加する
    function addRow() {
      const futakuInput = document.getElementById("futakuInput");
      const dateInput = document.getElementById("dateInput");

      const futakuVal = futakuInput.value.trim();
      const dateVal = dateInput.value.trim();

      if(!futakuVal || !dateVal) {
        alert("付託番号とステータス移行月日を入力してください。");
        return;
      }

      const table = document.getElementById("myTable").getElementsByTagName("tbody")[0];
      const newRow = table.insertRow();

      // 付託番号セル
      const cellFutaku = newRow.insertCell();
      cellFutaku.innerText = futakuVal;

      // ステータス移行月日セル
      const cellDate = newRow.insertCell();
      cellDate.innerText = dateVal;

      // 完了ボタンセル
      const cellComplete = newRow.insertCell();
      const completeBtn = document.createElement("button");
      completeBtn.innerText = "完了";
      completeBtn.addEventListener("click", () => {
        // 完了クリック時は行にcompletedクラスを付与
        newRow.classList.toggle("completed");
      });
      cellComplete.appendChild(completeBtn);

      // 入力欄をクリア
      futakuInput.value = "";
      dateInput.value = "";
    }

    // 完了にした行を一括非表示にする
    function hideCompletedRows() {
      const table = document.getElementById("myTable");
      const rows = table.querySelectorAll("tbody tr");

      rows.forEach(row => {
        if(row.classList.contains("completed")) {
          // completedクラスのついた行は非表示にする
          row.classList.add("hidden");
        }
      });
    }
  </script>
</body>
</html>
